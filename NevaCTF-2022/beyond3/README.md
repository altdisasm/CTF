# Beyond3

У нас есть [файл](/NevaCTF-2022/beyond3/files/beyond3), с названием beyond3 и команда для подключения к удаленному серверу. Это простой исполняемый файл, как узнать об это можно посмотреть в разборе задания **beyond2**.

Далее можно запустить файл, чтобы посмотреть как ведет себя программа. Сначала программа просит ввести имя, потом несколько числе друг за другом, печатая после каждого ввода **More** или **Less**. Похоже на игру в которой нужно угадать число.

![Program](/NevaCTF-2022/beyond3/img/prog.PNG)

Чтобы понять как работает программа, декомпилируем исполняемый файл. Программа небольшая, всего несколько функций.

### main
В которой по сути просто выполняется запуск функции `play`.

![main function](/NevaCTF-2022/beyond3/img/main.PNG)

### rand_num
Функция генерации случайного числа.

![rand_num function](/NevaCTF-2022/beyond3/img/rand_num.PNG)

### win
Функция, которая при некоторых условиях печатает флаг.

![win function](/NevaCTF-2022/beyond3/img/win.PNG)

### play
Наиболее интересная функция, т.к. в ней происходит основная активность. На самом деле, после ввода имени, программа предлагает угадать число от 1 до значения переменной `local14`, которое равно 1000, за 7 попыток. 

![play function](/NevaCTF-2022/beyond3/img/play.PNG)

Все решение завязано на том, что имя считывается функцией `fgets`, которая не проверяет размер введенной строки перед записью в буфер, в следствии чего возникает **переполнение**.

Чтобы получить флаг необходимо:
1. Перезаписать значение переменной `local14` на такое, которое можно отгадать за 7 попыток.
2. Перезаписать адрес возврата функции на адрес функции `win`. При этом условие в функции `win` выполнится и вы получите флаг.

Чтобы получить флаг достаточно отправить правильный набор байтов в момент ввода имени:
1. 32 любых байта - размер буфера
2. 4 любых байта - `int` переменная `local18`
3. 4 байта - значение которым будет перезаписана переменная `local14`
4. 16 любых байт - место до адреса возврата
5. 8 байт - адрес функции `win`

Чтобы определить смещение для адреса возврата, можно запустить программу под дебагером.

Пример кода формирования строки, которую можно отправить для получения флага (Python, нужна бибилиотке pwntools):

```
b"A"* 36 + p32(7) + b"A"* 16 + p64(0x401172)
```

![Final](/NevaCTF-2022/beyond3/img/final.PNG)

## Well done!!!